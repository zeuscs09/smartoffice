var X=Object.defineProperty,E=Object.defineProperties;var G=Object.getOwnPropertyDescriptors;var A=Object.getOwnPropertySymbols;var K=Object.prototype.hasOwnProperty,W=Object.prototype.propertyIsEnumerable;var $=(e,i,s)=>i in e?X(e,i,{enumerable:!0,configurable:!0,writable:!0,value:s}):e[i]=s,z=(e,i)=>{for(var s in i||(i={}))K.call(i,s)&&$(e,s,i[s]);if(A)for(var s of A(i))W.call(i,s)&&$(e,s,i[s]);return e},_=(e,i)=>E(e,G(i));var D=(e,i,s)=>new Promise((g,h)=>{var f=a=>{try{r(s.next(a))}catch(l){h(l)}},x=a=>{try{r(s.throw(a))}catch(l){h(l)}},r=a=>a.done?g(a.value):Promise.resolve(a.value).then(f,x);r((s=s.apply(e,i)).next())});import{J as Y,p as Q,d as V,m as Z,q as R,o as u,c,a as t,I as p,l as y,t as d,b as w,F as j,i as B,B as m,y as C,_ as I,u as tt,r as b,g as et,h as st,w as at,v as M,x as lt,z as F,H as O,C as ot}from"./index-BjUjyLbN.js";import{u as rt}from"./userLayout-ZLl1ofLD.js";import{U}from"./UserAvatar--QHl542-.js";import{_ as nt}from"./Pagination.vue_vue_type_script_setup_true_lang-BjD5Jrpi.js";const it=Y("mailBoxStore",{state:()=>({currentPage:1,pageSize:10,documentsResource:Q({url:"smartoffice.api.mailbox.get_mail_box",auto:!1}),searchQuery:"",statusFilter:"",startDate:"",endDate:"",sortField:"",sortOrder:"asc"}),actions:{fetchAll(e){return this.currentPage=e,this.documentsResource.fetch({page:this.currentPage,page_size:this.pageSize,search:this.searchQuery,status:this.statusFilter,start_date:this.startDate,end_date:this.endDate,sort_field:this.sortField,sort_order:this.sortOrder}),this.documentsResource},setSearchQuery(e){this.searchQuery=e,this.fetchAll(1)},setStatusFilter(e){this.statusFilter=e,this.fetchAll(1)},setDateRange(e,i){this.startDate=e,this.endDate=i,this.fetchAll(1)},setSorting(e){this.sortField===e?this.sortOrder=this.sortOrder==="asc"?"desc":"asc":(this.sortField=e,this.sortOrder="asc"),this.fetchAll(this.currentPage)},nextPage(){this.currentPage<this.totalPages&&this.fetchAll(this.currentPage+1)},previousPage(){this.currentPage>1&&this.fetchAll(this.currentPage-1)},goToPage(e){e>=1&&e<=this.totalPages&&this.fetchAll(e)},get(e){return this.data.find(i=>i.id===e)}},getters:{data(){var e;return((e=this.documentsResource.data)==null?void 0:e.data)||[]},isFirstPage(){return this.currentPage===1},isLastPage(){return this.currentPage===this.totalPages},totalRecords(){var e;return((e=this.documentsResource.data)==null?void 0:e.total)||0},totalPages(){var e;return((e=this.documentsResource.data)==null?void 0:e.total_pages)||1}}}),dt={class:"hidden md:block overflow-x-auto mt-4"},ut={class:"table table-zebra w-full"},ct={key:0,class:"ml-1"},mt={key:0,class:"ml-1"},gt={key:0,class:"ml-1"},ht={key:0},ft={key:1},vt=["onClick"],xt={class:"text-xs text-gray-500"},yt={class:"text-xs text-gray-500"},bt={class:"flex items-center gap-2"},pt={class:"text-xs text-gray-500"},wt={key:2},Ft={class:"md:hidden space-y-4 mt-4"},kt={key:0,class:"card bg-base-100 shadow-xl animate-pulse"},St={key:1},Pt={class:"card-body p-4"},Dt={class:"flex justify-between items-start mb-2"},Ot=["onClick"],Rt={class:"text-sm text-gray-600 mb-1"},Ct={class:"text-xs text-gray-500 mb-2"},At={class:"flex justify-between items-center mt-2"},$t={class:"flex items-center gap-2"},zt={class:"text-xs text-gray-500"},_t={class:"text-xs text-gray-500"},jt={key:2,class:"card bg-base-100 shadow-xl"},Bt=V({__name:"MailboxTable",props:{data:{type:Array,required:!0},loading:{type:Boolean,default:!1},sortField:{type:String,default:""},sortOrder:{type:String,default:"asc"},sortable:{type:Boolean,default:!0}},emits:["sort"],setup(e,{emit:i}){const s=e,g=Z("formatDate"),h=r=>r.hasAttachments?[{type:"PDF",name:"document.pdf"},{type:"XLSX",name:"spreadsheet.xlsx"}]:[];R(()=>s.sortable?[...s.data].sort((r,a)=>r[s.sortField]<a[s.sortField]?s.sortOrder==="asc"?-1:1:r[s.sortField]>a[s.sortField]?s.sortOrder==="asc"?1:-1:0).map(r=>_(z({},r),{attachments:h(r),preview:r.content?r.content.substring(0,50)+"...":""})):s.data);const f=(r,a)=>D(this,null,function*(){yield x(a),location.href=r}),x=r=>D(this,null,function*(){try{Q({url:"smartoffice.api.mailbox.update_notification_read",auto:!1}).fetch({name:r}),console.log("อัปเดตสถานะการอ่านและการเห็นสำเร็จ")}catch(a){console.error("เกิดข้อผิดพลาดในการอัปเดตสถานะ:",a)}});return(r,a)=>(u(),c("div",null,[t("div",dt,[t("table",ut,[t("thead",null,[t("tr",null,[t("th",{class:"cursor-pointer",onClick:a[0]||(a[0]=l=>r.$emit("sort","document_name"))},[a[3]||(a[3]=p(" No. ")),e.sortable?(u(),c("span",ct,[t("span",{class:y({"text-primary":e.sortField==="document_name"})},d(e.sortField==="document_name"&&e.sortOrder==="asc"?"▲":"△"),3),t("span",{class:y({"text-primary":e.sortField==="document_name"})},d(e.sortField==="document_name"&&e.sortOrder==="document_name"?"▼":"▽"),3)])):w("",!0)]),t("th",{class:"cursor-pointer",onClick:a[1]||(a[1]=l=>r.$emit("sort","subject"))},[a[4]||(a[4]=p(" Subject ")),e.sortable?(u(),c("span",mt,[t("span",{class:y({"text-primary":e.sortField==="subject"})},d(e.sortField==="subject"&&e.sortOrder==="asc"?"▲":"△"),3),t("span",{class:y({"text-primary":e.sortField==="subject"})},d(e.sortField==="subject"&&e.sortOrder==="desc"?"▼":"▽"),3)])):w("",!0)]),t("th",{class:"cursor-pointer",onClick:a[2]||(a[2]=l=>r.$emit("sort","workflow_state"))},[a[5]||(a[5]=p(" Status ")),e.sortable?(u(),c("span",gt,[t("span",{class:y({"text-primary":e.sortField==="workflow_state"})},d(e.sortField==="workflow_state"&&e.sortOrder==="asc"?"▲":"△"),3),t("span",{class:y({"text-primary":e.sortField==="workflow_state"})},d(e.sortField==="workflow_state"&&e.sortOrder==="desc"?"▼":"▽"),3)])):w("",!0)]),a[6]||(a[6]=t("th",null,"Request By",-1))])]),e.loading?(u(),c("tbody",ht,a[7]||(a[7]=[t("tr",{class:"h-[500px]"},[t("td",{colspan:"5",class:"text-center text-gray-500"},[t("div",{class:"flex justify-center items-center h-full"},[t("div",{class:"flex w-52 flex-col gap-4"},[t("div",{class:"skeleton h-32 w-full"}),t("div",{class:"skeleton h-4 w-28"}),t("div",{class:"skeleton h-4 w-full"}),t("div",{class:"skeleton h-4 w-full"})])])])],-1)]))):e.data.length>0?(u(),c("tbody",ft,[(u(!0),c(j,null,B(e.data,l=>(u(),c("tr",{key:l.name},[t("td",null,[t("div",{class:"cursor-pointer",onClick:k=>f(l.link,l.name)},[p(d(l.document_name)+" ",1),a[8]||(a[8]=t("br",null,null,-1)),t("span",xt,d((l==null?void 0:l.doctype_description)||l.document_type),1)],8,vt)]),t("td",null,[p(d(l.subject)+" ",1),a[9]||(a[9]=t("br",null,null,-1)),t("span",yt,d(m(g)(l.creation)),1)]),t("td",null,d(l.read?"Read":"Unread"),1),t("td",bt,[C(U,{email:l.owner},null,8,["email"]),t("span",pt,d(l.full_name),1)])]))),128))])):(u(),c("tbody",wt,a[10]||(a[10]=[t("tr",{class:"h-[300px]"},[t("td",{colspan:"5",class:"text-center text-gray-500"},[t("div",{class:"flex justify-center items-center h-full"},[t("div",{class:"text-lg font-bold"}," ไม่พบข้อมูล")])])],-1)])))])]),t("div",Ft,[e.loading?(u(),c("div",kt,a[11]||(a[11]=[t("div",{class:"card-body"},[t("div",{class:"h-4 bg-gray-300 rounded w-3/4 mb-2"}),t("div",{class:"h-4 bg-gray-300 rounded w-1/2 mb-2"}),t("div",{class:"h-4 bg-gray-300 rounded w-1/4"})],-1)]))):e.data.length>0?(u(),c("div",St,[(u(!0),c(j,null,B(e.data,l=>(u(),c("div",{key:l.name,class:"card bg-base-100 shadow-xl mb-4"},[t("div",Pt,[t("div",Dt,[t("h2",{class:"card-title text-base cursor-pointer",onClick:k=>f(l.link,l.name)},d(l.document_name),9,Ot),t("span",{class:y(["badge badge-sm",{"badge-primary":!l.read,"badge-ghost":l.read}])},d(l.read?"Read":"Unread"),3)]),t("p",Rt,d(l.subject),1),t("p",Ct,d((l==null?void 0:l.doctype_description)||l.document_type),1),t("div",At,[t("div",$t,[C(U,{email:l.owner},null,8,["email"]),t("span",zt,d(l.full_name),1)]),t("span",_t,d(m(g)(l.creation)),1)])])]))),128))])):(u(),c("div",jt,a[12]||(a[12]=[t("div",{class:"card-body"},[t("p",{class:"text-center text-gray-500"},"ไม่พบข้อมูล")],-1)])))])]))}}),Mt=I(Bt,[["__scopeId","data-v-5b41f033"]]),Ut={class:"container mx-auto p-4"},Qt={class:"flex justify-between items-center mb-4"},Vt={class:"breadcrumbs text-sm"},It={class:"flex gap-2"},Lt={key:0,class:"flex flex-wrap gap-4 mb-4"},Nt={class:"overflow-x-auto mt-4"},Tt=V({__name:"MailBoxList",setup(e){const i=tt(),s=it();s.pageSize=10;const g=b(""),h=b(""),f=b(""),x=b(""),r=b(10),a=b(!1),l=R(()=>s.data.length),k=R(()=>{var n;return((n=s.documentsResource.data)==null?void 0:n.total)||0}),S=()=>{const n={searchQuery:g.value,statusFilter:h.value,startDate:f.value,endDate:x.value,pageSize:r.value,showFilter:a.value,currentPage:s.currentPage};localStorage.setItem("mailboxState",JSON.stringify(n))},L=()=>{const n=localStorage.getItem("mailboxState");if(n){const o=JSON.parse(n);g.value=o.searchQuery,h.value=o.statusFilter,f.value=o.startDate,x.value=o.endDate,r.value=o.pageSize,a.value=o.showFilter,N(o)}},N=n=>{s.searchQuery=n.searchQuery,s.statusFilter=n.statusFilter,s.startDate=n.startDate,s.endDate=n.endDate,s.pageSize=n.pageSize,s.currentPage=n.currentPage};et(()=>{L(),s.fetchAll(1)}),st(()=>{S()});const T=()=>{a.value=!a.value},q=()=>{s.searchQuery=g.value,s.fetchAll(1),S()},P=()=>{s.statusFilter=h.value,s.startDate=f.value,s.endDate=x.value,s.fetchAll(1),S()},J=n=>{s.sortField===n?s.sortOrder=s.sortOrder==="asc"?"desc":"asc":(s.sortField=n,s.sortOrder="asc"),s.fetchAll(1)},H=n=>{r.value=n,s.pageSize=n,s.fetchAll(1)};return at(r,n=>{console.log("Page size changed to:",n)}),(n,o)=>(u(),M(rt,null,{default:lt(()=>[t("div",Ut,[t("div",Qt,[t("div",Vt,[t("ul",null,[t("li",null,[t("a",{onClick:o[0]||(o[0]=v=>m(i).push("/"))},"Home")]),o[7]||(o[7]=t("li",null,"Mailbox",-1))])]),t("div",It,[t("button",{class:y(["btn btn-sm",{"btn-ghost":!a.value}]),onClick:T},o[8]||(o[8]=[t("svg",{xmlns:"http://www.w3.org/2000/svg",class:"h-5 w-5 mr-2",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},[t("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M3 4a1 1 0 011-1h16a1 1 0 011 1v2.586a1 1 0 01-.293.707l-6.414 6.414a1 1 0 00-.293.707V17l-4 4v-6.586a1 1 0 00-.293-.707L3.293 7.293A1 1 0 013 6.586V4z"})],-1)]),2)])]),a.value?(u(),c("div",Lt,[F(t("input",{type:"text",placeholder:"Search...",class:"input input-bordered flex-grow","onUpdate:modelValue":o[1]||(o[1]=v=>g.value=v),onInput:q},null,544),[[O,g.value]]),F(t("select",{class:"select select-bordered w-full max-w-xs","onUpdate:modelValue":o[2]||(o[2]=v=>h.value=v),onChange:P},o[9]||(o[9]=[t("option",{value:""},"All",-1),t("option",{value:"read"},"Read",-1),t("option",{value:"unread"},"Unread",-1)]),544),[[ot,h.value]]),F(t("input",{type:"date",class:"input input-bordered","onUpdate:modelValue":o[3]||(o[3]=v=>f.value=v),onChange:P},null,544),[[O,f.value]]),F(t("input",{type:"date",class:"input input-bordered","onUpdate:modelValue":o[4]||(o[4]=v=>x.value=v),onChange:P},null,544),[[O,x.value]])])):w("",!0),t("div",Nt,[C(Mt,{data:m(s).data,loading:m(s).documentsResource.loading,error:m(s).documentsResource.error,sortField:m(s).sortField,sortOrder:m(s).sortOrder,sortable:!0,onSort:J},null,8,["data","loading","error","sortField","sortOrder"])]),m(s).data.length>0?(u(),M(nt,{key:1,"current-page":m(s).currentPage,"is-first-page":m(s).isFirstPage,"is-last-page":m(s).isLastPage,"page-size":r.value,"displayed-items-count":l.value,"total-items":k.value,onPrevious:o[5]||(o[5]=v=>m(s).previousPage()),onNext:o[6]||(o[6]=v=>m(s).nextPage()),"onUpdate:pageSize":H},null,8,["current-page","is-first-page","is-last-page","page-size","displayed-items-count","total-items"])):w("",!0)])]),_:1}))}}),Gt=I(Tt,[["__scopeId","data-v-9fc0a6df"]]);export{Gt as default};

var q=(s,f,o)=>new Promise((w,h)=>{var b=d=>{try{c(o.next(d))}catch(g){h(g)}},x=d=>{try{c(o.throw(d))}catch(g){h(g)}},c=d=>d.done?w(d.value):Promise.resolve(d.value).then(b,x);c((o=o.apply(s,f)).next())});import{J as N,p as $,d as E,m as A,u as j,q as z,r as D,o as r,c as l,a as t,I as P,l as m,t as n,b as p,F as S,i as O,B as k,y,v as B,E as L,L as T,_ as V}from"./index-BaVYsHIV.js";import{U as v}from"./UserAvatar-CeC7Avae.js";import{_ as M}from"./TimeLine.vue_vue_type_script_setup_true_lang-BNF3soDH.js";const xt=N("expenseRequest",{state:()=>({currentPage:1,pageSize:10,totalPages:1,documentsResource:$({url:"smartoffice.api.expense.get_expense_request_by_user",auto:!1}),searchQuery:"",statusFilter:"",startDate:"",endDate:"",sortField:"",sortOrder:"asc"}),actions:{fetchAll(s){return this.currentPage=s,this.documentsResource.fetch({page:this.currentPage,page_size:this.pageSize,search:this.searchQuery,status:this.statusFilter,start_date:this.startDate,end_date:this.endDate,sort_field:this.sortField,sort_order:this.sortOrder}),this.documentsResource},setSearchQuery(s){this.searchQuery=s,this.fetchAll(1)},setStatusFilter(s){this.statusFilter=s,this.fetchAll(1)},setDateRange(s,f){this.startDate=s,this.endDate=f,this.fetchAll(1)},setSorting(s){this.sortField===s?this.sortOrder=this.sortOrder==="asc"?"desc":"asc":(this.sortField=s,this.sortOrder="asc"),this.fetchAll(this.currentPage)},nextPage(){this.currentPage<this.totalPages&&this.fetchAll(this.currentPage+1)},previousPage(){this.currentPage>1&&this.fetchAll(this.currentPage-1)},goToPage(s){s>=1&&s<=this.totalPages&&this.fetchAll(s)},get(s){return this.data.find(f=>f.id===s)}},getters:{data(){var s;return((s=this.documentsResource.data)==null?void 0:s.data)||[]},isFirstPage(){return this.currentPage===1},isLastPage(){return this.currentPage===this.totalPages},totalPages(){var s;return((s=this.documentsResource.data)==null?void 0:s.total_pages)||1}}}),Q={class:"hidden md:block overflow-x-auto mt-4"},_={class:"table table-zebra w-full"},I={key:0,class:"ml-1"},U={key:0,class:"ml-1"},J={key:0,class:"ml-1"},G={key:0},H={key:1},K={key:2},W=["onClick"],X={class:"text-xs text-gray-500"},Y=["onClick"],Z={key:3},tt={class:"md:hidden space-y-4 mt-4"},et={key:0},st={key:1},at={key:2},rt={class:"card-body"},lt=["onClick"],ot={class:"grid grid-cols-2 gap-2 mt-2"},nt={class:"flex flex-col items-center"},it={class:"text-xs text-gray-500 mt-1"},dt={class:"flex justify-between mt-2"},ut={key:1},ct=["onClick"],mt={key:3},ft={class:"modal-box w-11/12 max-w-5xl"},gt=E({__name:"ExpenseRequestTable",props:{data:{type:Array,required:!0},loading:{type:Boolean,default:!1},error:{type:Boolean,default:!1},sortField:{type:String,default:""},sortOrder:{type:String,default:"asc"},sortable:{type:Boolean,default:!0}},emits:["sort"],setup(s,{emit:f}){const o=s,w=f,h=A("formatDate"),b=A("formatCurrency");j();const x=i=>{switch(i.toLowerCase()){case"draft":return"badge badge-ghost";case"pending approval":return"badge badge-warning";case"approved":return"badge badge-success";case"rejected":return"badge badge-error";default:return"badge"}},c=z(()=>!o.sortable||!o.sortField?o.data:[...o.data].sort((i,e)=>i[o.sortField]<e[o.sortField]?o.sortOrder==="asc"?-1:1:i[o.sortField]>e[o.sortField]?o.sortOrder==="asc"?1:-1:0)),d=i=>{o.sortable&&w("sort",i)},g=i=>{location.href=`/app/smo-expense-request/${i}?from=frontend`},R=D(null),F=D([]),C=i=>q(this,null,function*(){var a;console.log(i);const e=T({doctype:"SMO Expense Request",name:i,auto:!1});yield e.reload(),console.log(e.doc.approvers),F.value=e.doc.approvers.map(u=>({date:u.action_date,status:u.status,action:u.status,approve_role:u.approver_role,by:u.user_id})),F.value.unshift({date:e.doc.creation,action:"Submit Request",status:"Approved",approve_role:"Requestor",by:e.doc.owner}),(a=R.value)==null||a.showModal()});return(i,e)=>(r(),l("div",null,[t("div",Q,[t("table",_,[t("thead",null,[t("tr",null,[t("th",{class:"cursor-pointer",onClick:e[0]||(e[0]=a=>d("name"))},[e[3]||(e[3]=P(" No. ")),s.sortable?(r(),l("span",I,[t("span",{class:m({"text-primary":s.sortField==="name"})},n(s.sortField==="name"&&s.sortOrder==="asc"?"▲":"△"),3),t("span",{class:m({"text-primary":s.sortField==="name"})},n(s.sortField==="name"&&s.sortOrder==="desc"?"▼":"▽"),3)])):p("",!0)]),t("th",{class:"cursor-pointer",onClick:e[1]||(e[1]=a=>d("creation"))},[e[4]||(e[4]=P(" Request Date ")),s.sortable?(r(),l("span",U,[t("span",{class:m({"text-primary":s.sortField==="creation"})},n(s.sortField==="creation"&&s.sortOrder==="asc"?"▲":"△"),3),t("span",{class:m({"text-primary":s.sortField==="creation"})},n(s.sortField==="creation"&&s.sortOrder==="desc"?"▼":"▽"),3)])):p("",!0)]),t("th",{class:"cursor-pointer",onClick:e[2]||(e[2]=a=>d("workflow_state"))},[e[5]||(e[5]=P(" Status ")),s.sortable?(r(),l("span",J,[t("span",{class:m({"text-primary":s.sortField==="workflow_state"})},n(s.sortField==="workflow_state"&&s.sortOrder==="asc"?"▲":"△"),3),t("span",{class:m({"text-primary":s.sortField==="workflow_state"})},n(s.sortField==="workflow_state"&&s.sortOrder==="desc"?"▼":"▽"),3)])):p("",!0)]),e[6]||(e[6]=t("th",null,"Request By",-1)),e[7]||(e[7]=t("th",null,"Next Action",-1)),e[8]||(e[8]=t("th",null,"Approver",-1))])]),s.loading?(r(),l("tbody",G,e[9]||(e[9]=[t("tr",{class:"h-[300px]"},[t("td",{colspan:"5",class:"text-center text-gray-500"},[t("div",{class:"flex justify-center items-center h-full"},[t("div",{class:"text-lg font-bold"}," Loading...")])])],-1)]))):s.error?(r(),l("tbody",H,e[10]||(e[10]=[t("tr",{class:"h-[300px]"},[t("td",{colspan:"5",class:"text-center text-gray-500"},[t("div",{class:"flex justify-center items-center h-full"},[t("div",{class:"text-lg font-bold"},"เกิดข้อผิดพลาดในการโหลดข้อมูล")])])],-1)]))):c.value.length>0?(r(),l("tbody",K,[(r(!0),l(S,null,O(c.value,a=>(r(),l("tr",{key:a.name},[t("td",{onClick:u=>g(a.name),class:"cursor-pointer"},[t("span",null,n(a.name),1),e[11]||(e[11]=t("br",null,null,-1)),t("span",X,n(k(b)(a.total)),1)],8,W),t("td",null,n(k(h)(a.creation)),1),t("td",null,[t("span",{class:m(x(a.workflow_state))},n(a.workflow_state),3)]),t("td",null,[y(v,{email:a.request_by},null,8,["email"])]),t("td",null,[a.next_action?(r(),B(v,{key:0,email:a.next_action},null,8,["email"])):p("",!0)]),t("td",null,[t("div",{class:"cursor-pointer",onClick:u=>C(a.name)},[y(v,{email:a.approvers},null,8,["email"])],8,Y)])]))),128))])):(r(),l("tbody",Z,e[12]||(e[12]=[t("tr",{class:"h-[300px]"},[t("td",{colspan:"5",class:"text-center text-gray-500"},[t("div",{class:"flex justify-center items-center h-full"},[t("div",{class:"text-lg font-bold"}," No Data Found")])])],-1)])))])]),t("div",tt,[s.loading?(r(),l("div",et,e[13]||(e[13]=[L('<div class="card bg-base-100 shadow-xl animate-pulse" data-v-c68f5858><div class="card-body" data-v-c68f5858><div class="h-4 bg-gray-300 rounded w-3/4 mb-2" data-v-c68f5858></div><div class="h-4 bg-gray-300 rounded w-1/2 mb-2" data-v-c68f5858></div><div class="h-4 bg-gray-300 rounded w-1/4" data-v-c68f5858></div></div></div>',1)]))):s.error?(r(),l("div",st,e[14]||(e[14]=[t("div",{class:"card bg-base-100 shadow-xl"},[t("div",{class:"card-body"},[t("p",{class:"text-center text-error"},"เกิดข้อผิดพลาดในการโหลดข้อมูล")])],-1)]))):c.value.length>0?(r(),l("div",at,[(r(!0),l(S,null,O(c.value,a=>(r(),l("div",{key:a.name,class:"card bg-base-100 shadow-xl"},[t("div",rt,[t("h2",{class:"card-title cursor-pointer",onClick:u=>g(a.name)},n(a.name),9,lt),t("div",ot,[t("div",null,[e[15]||(e[15]=t("p",{class:"font-semibold"},"Amont",-1)),t("p",null,n(k(b)(a.total)),1),t("span",{class:m(x(a.workflow_state))},n(a.workflow_state),3)]),t("div",nt,[e[16]||(e[16]=t("p",{class:"font-semibold mb-2"},"Request By:",-1)),y(v,{email:a.request_by,class:"mb-1"},null,8,["email"]),t("p",it,n(k(h)(a.creation)),1)])]),t("div",dt,[t("div",null,[e[17]||(e[17]=t("p",{class:"font-semibold"},"Next Action:",-1)),a.next_action?(r(),B(v,{key:0,email:a.next_action},null,8,["email"])):(r(),l("span",ut,"-"))]),t("div",null,[e[18]||(e[18]=t("p",{class:"font-semibold"},"Approver:",-1)),t("div",{class:"cursor-pointer",onClick:u=>C(a.name)},[y(v,{email:a.approvers},null,8,["email"])],8,ct)])])])]))),128))])):(r(),l("div",mt,e[19]||(e[19]=[t("div",{class:"card bg-base-100 shadow-xl"},[t("div",{class:"card-body"},[t("p",{class:"text-center"},"No Data Found")])],-1)])))]),t("dialog",{id:"timeline_modal",class:"modal",ref_key:"timelineModal",ref:R},[t("div",ft,[e[20]||(e[20]=t("h3",{class:"font-bold text-lg mb-4"},"ประวัติการอนุมัติ",-1)),y(M,{events:F.value},null,8,["events"]),e[21]||(e[21]=t("div",{class:"modal-action"},[t("form",{method:"dialog"},[t("button",{class:"btn"},"ปิด")])],-1))])],512)]))}}),pt=V(gt,[["__scopeId","data-v-c68f5858"]]);export{pt as E,xt as u};

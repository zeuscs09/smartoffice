var p=(t,m,o)=>new Promise((v,g)=>{var w=d=>{try{f(o.next(d))}catch(r){g(r)}},h=d=>{try{f(o.throw(d))}catch(r){g(r)}},f=d=>d.done?v(d.value):Promise.resolve(d.value).then(w,h);f((o=o.apply(t,m)).next())});import{J as A,p as S,d as D,m as P,r as C,q as O,o as n,c as l,a as e,I as y,l as u,t as i,b as F,y as c,F as R,i as _,B as k,L as E,_ as $}from"./index-BjUjyLbN.js";import{U as b}from"./UserAvatar--QHl542-.js";import{_ as N}from"./TimeLine.vue_vue_type_script_setup_true_lang-DCBmTZH1.js";import{S as q,N as B}from"./NoDataFoundTable-CQstSkm9.js";import{S as T,N as z}from"./NoDataFoundCard-Dr_8P_bw.js";const wt=A("expenseEntry",{state:()=>({currentPage:1,pageSize:10,documentsResource:S({url:"smartoffice.api.expense.get_expense_entry_by_user",auto:!1}),searchQuery:"",statusFilter:"",startDate:"",endDate:"",sortField:"",sortOrder:"asc"}),actions:{fetchAll(t){return this.currentPage=t,this.documentsResource.fetch({page:this.currentPage,page_size:this.pageSize,search:this.searchQuery,status:this.statusFilter,start_date:this.startDate,end_date:this.endDate,sort_field:this.sortField,sort_order:this.sortOrder}),this.documentsResource},setSearchQuery(t){this.searchQuery=t,this.fetchAll(1)},setStatusFilter(t){this.statusFilter=t,this.fetchAll(1)},setDateRange(t,m){this.startDate=t,this.endDate=m,this.fetchAll(1)},setSorting(t){this.sortField===t?this.sortOrder=this.sortOrder==="asc"?"desc":"asc":(this.sortField=t,this.sortOrder="asc"),this.fetchAll(this.currentPage)},nextPage(){this.currentPage<this.totalPages&&this.fetchAll(this.currentPage+1)},previousPage(){this.currentPage>1&&this.fetchAll(this.currentPage-1)},goToPage(t){t>=1&&t<=this.totalPages&&this.fetchAll(t)},get(t){return this.data.find(m=>m.id===t)}},getters:{data(){var t;return((t=this.documentsResource.data)==null?void 0:t.data)||[]},isFirstPage(){return this.currentPage===1},isLastPage(){return this.currentPage===this.totalPages},totalPages(){var t;return((t=this.documentsResource.data)==null?void 0:t.total_pages)||1}}}),V={class:"hidden md:block overflow-x-auto mt-4"},j={class:"table table-zebra w-full"},M={key:0,class:"ml-1"},Q={key:0,class:"ml-1"},L={key:0,class:"ml-1"},I={key:0},U={colspan:"5"},J={key:1},G=["onClick"],H={class:"text-xs text-gray-500"},K=["onClick"],W={key:2},X={colspan:"5"},Y={class:"md:hidden space-y-4 mt-4"},Z={key:0},tt={key:1},et={class:"card-body"},st=["onClick"],at={class:"text-sm text-gray-500"},ot={class:"grid grid-cols-1 gap-2 mt-2"},rt={class:"flex items-center gap-2"},nt={class:"text-xs text-gray-500"},lt={class:"flex justify-between items-center"},it=["onClick"],dt={key:2},ct={class:"modal-box w-11/12 max-w-5xl"},ut=D({__name:"ExpenseEntryTable",props:{data:{type:Array,required:!0},loading:{type:Boolean,default:!1},sortField:{type:String,default:""},sortOrder:{type:String,default:"asc"},sortable:{type:Boolean,default:!0}},emits:["sort"],setup(t,{emit:m}){const o=t,v=P("formatDate"),g=P("formatCurrency"),w=C(null),h=C([]);O(()=>o.sortable?[...o.data].sort((r,s)=>r[o.sortField]<s[o.sortField]?o.sortOrder==="asc"?-1:1:r[o.sortField]>s[o.sortField]?o.sortOrder==="asc"?1:-1:0):o.data);const f=r=>{location.href=`/app/smo-expense-entry/${r}?from=frontend`},d=r=>p(this,null,function*(){var a;const s=E({doctype:"SMO Expense Entry",name:r,auto:!1});h.value=[],yield s.reload(),console.log(s.doc),h.value.push({date:s.doc.creation,action:"Submit Request",status:"Approved",approve_role:"Requestor",by:s.doc.owner}),h.value.push({date:s.doc.creation,action:s.doc.workflow_state,status:s.doc.workflow_state,approve_role:"Vice President",by:s.doc.approver}),(a=w.value)==null||a.showModal()});return(r,s)=>(n(),l("div",null,[e("div",V,[e("table",j,[e("thead",null,[e("tr",null,[e("th",{class:"cursor-pointer",onClick:s[0]||(s[0]=a=>r.$emit("sort","name"))},[s[3]||(s[3]=y(" No. ")),t.sortable?(n(),l("span",M,[e("span",{class:u({"text-primary":t.sortField==="name"})},i(t.sortField==="name"&&t.sortOrder==="asc"?"▲":"△"),3),e("span",{class:u({"text-primary":t.sortField==="name"})},i(t.sortField==="name"&&t.sortOrder==="desc"?"▼":"▽"),3)])):F("",!0)]),e("th",{class:"cursor-pointer",onClick:s[1]||(s[1]=a=>r.$emit("sort","creation"))},[s[4]||(s[4]=y(" Request Date ")),t.sortable?(n(),l("span",Q,[e("span",{class:u({"text-primary":t.sortField==="creation"})},i(t.sortField==="creation"&&t.sortOrder==="asc"?"▲":"△"),3),e("span",{class:u({"text-primary":t.sortField==="creation"})},i(t.sortField==="creation"&&t.sortOrder==="desc"?"▼":"▽"),3)])):F("",!0)]),e("th",{class:"cursor-pointer",onClick:s[2]||(s[2]=a=>r.$emit("sort","workflow_state"))},[s[5]||(s[5]=y(" Status ")),t.sortable?(n(),l("span",L,[e("span",{class:u({"text-primary":t.sortField==="workflow_state"})},i(t.sortField==="workflow_state"&&t.sortOrder==="asc"?"▲":"△"),3),e("span",{class:u({"text-primary":t.sortField==="workflow_state"})},i(t.sortField==="workflow_state"&&t.sortOrder==="desc"?"▼":"▽"),3)])):F("",!0)]),s[6]||(s[6]=e("th",null,"Request By",-1)),s[7]||(s[7]=e("th",null,"Approver",-1))])]),t.loading?(n(),l("tbody",I,[e("tr",null,[e("td",U,[c(q)])])])):t.data.length>0?(n(),l("tbody",J,[(n(!0),l(R,null,_(t.data,a=>(n(),l("tr",{key:a.name},[e("td",null,[e("div",{class:"cursor-pointer",onClick:x=>f(a.name)},[y(i(a.name)+" ",1),s[8]||(s[8]=e("br",null,null,-1)),e("span",H,i(k(g)(a.total_amount)),1)],8,G)]),e("td",null,i(k(v)(a.creation)),1),e("td",null,[e("div",{class:u(["badge badge-sm",{"badge-primary":a.workflow_state==="Approved","badge-warning":a.workflow_state==="Approval Review","badge-error":a.workflow_state==="Rejected"}])},i(a.workflow_state),3)]),e("td",null,[c(b,{email:a.owner},null,8,["email"])]),e("td",null,[e("div",{class:"cursor-pointer",onClick:x=>d(a.name)},[c(b,{email:a.approver},null,8,["email"])],8,K)])]))),128))])):(n(),l("tbody",W,[e("tr",null,[e("td",X,[c(B)])])]))])]),e("div",Y,[t.loading?(n(),l("div",Z,[c(T)])):t.data.length>0?(n(),l("div",tt,[(n(!0),l(R,null,_(t.data,a=>(n(),l("div",{key:a.name,class:"card bg-base-100 shadow-xl"},[e("div",et,[e("h2",{class:"card-title cursor-pointer",onClick:x=>f(a.name)}," No. "+i(a.name),9,st),e("p",at,[y(i(k(g)(a.total_amount))+" ",1),e("span",{class:u(["badge badge-sm",{"badge-primary":a.workflow_state==="Approved","badge-warning":a.workflow_state==="Approval Review","badge-error":a.workflow_state==="Rejected"}])},i(a.workflow_state),3)]),e("div",ot,[e("div",rt,[c(b,{email:a.owner},null,8,["email"]),e("span",nt," Request Date "+i(k(v)(a.creation)),1)]),e("div",lt,[s[9]||(s[9]=e("p",{class:"font-semibold"},"Approver:",-1)),e("div",{class:"cursor-pointer",onClick:x=>d(a.name)},[c(b,{email:a.approver},null,8,["email"])],8,it)])])])]))),128))])):(n(),l("div",dt,[c(z)]))]),e("dialog",{id:"timeline_modal",class:"modal",ref_key:"timelineModal",ref:w},[e("div",ct,[s[10]||(s[10]=e("h3",{class:"font-bold text-lg mb-4"},"ประวัติการอนุมัติ",-1)),c(N,{events:h.value},null,8,["events"]),s[11]||(s[11]=e("div",{class:"modal-action"},[e("form",{method:"dialog"},[e("button",{class:"btn"},"ปิด")])],-1))])],512)]))}}),kt=$(ut,[["__scopeId","data-v-8d4ef4d9"]]);export{kt as E,wt as u};
